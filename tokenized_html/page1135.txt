nested arrayformula in google sheets averageifs on uniques stack overflow by using our site you acknowledge that you have read and understand our cookie policy privacy policy and our terms of service i am trying to get a way to apply some function to values in a table where the descriptor is in an array of unique descriptors for example averaging all of the values for a unique descriptor however i have the unique array function so i would like to just apply it to all of the values given by an array given by vlookup i would like this formula working as an array formula input in one cell that creates the length of array that is required rather than having to copy an unknown amount of rows =arrayformula averageifs values_to_avg descriptors unique descriptors or for a more general solution we would like something which can take different functions than average my poor attempt was this =arrayformula average arrayformula vlookup unique descriptors choose 1,2 descriptors values_to_avg 2,0 so my hope was to vlookup all the values for a unique descriptor where the range has been rearranged by choose now we want all the values where this unique desirptor is so we have to use arrayformula around that then we want the average of all of these values but for each unique desriptor so we need another arrayformula around that however this does not work so i am unsure of how to nest array formulas with vlookup s or filter s. does anyone have suggestions to get this with an arrayformula example i have two columns of expermental data or user input and i would like to get an array of the averages for all of the unique values.something like this =arrayformula averageifs a 2 a b 2 b unique b 2 b or this =arrayformula average arrayformula vlookup unique b 2 b choose 1,2 b 2 b a 2 a 2,0 can this nested array formula function work query works great for avg however stdev is not available with query arrayformula seems to have a problem with column lengths not matching after filtering for unique descriptor the best i have come up with is in d2 of you sample data put in e2 put to solve the problem of the formulas as new data is added put the following in the script editor and run it it will fill the formulas down i set the target how far down to copy the formula to 10 just for testing to d3 e10 however d3 e would fill the entire sheet the iferror will show these asblank until data is available see if this works for you click here to upload your image max 2 mib cancel and add another image you can also provide a link from the web log in by clicking post your answer you agree to our terms of service privacy policy and cookie policy 2019 stack exchange inc