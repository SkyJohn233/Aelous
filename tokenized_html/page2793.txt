message queue elements and features sun java system message queue 3.7 ur1 technical overview so far we have described the elements of message-oriented middlewareand the use of jms as a way of adding portability to mom applications itnow remains to describe how message queue implements the jms specificationand to introduce the features and tools it uses to provide reliable secure and scalable messaging service first like many jms provider message queue can be used as a stand-aloneproduct or it can be used as an enabling technology embedded in a j2ee applicationserver to provide asynchronous messaging chapter 5 message queue and j2ee describes the role message queue plays in j2eein greater detail unlike other jms providers message queue has been designatedas the jms reference implementation this designation attests to the factthat message queue is a correct and complete jms implementation it also guaranteesthat the message queue product will remain current with any future jms revisionsand extensions as a jms provider message queue offers a messaging service thatimplements the jms interfaces and that provides administrative services andcontrol so far in illustrating jms providers the focus has been mainlyon the role of the broker in relaying messages but in fact a jms providermust include many elements in addition to the broker to provide reliable secure scalable messaging figure 1 6 showsthe elements that make up the message queue message service these includea variety of connection services supporting different protocols administrativetools and data stores for messaging monitoring and user information the message queue serviceitself includes all elements marked in gray in the figure as you can see a full-featured jms provider is more complex than thebasic jms model would lead one to suspect the following sections describethe elements of the message queue service shown above these elements canbe divided into three categories the broker client runtime support andadministration as shown in figure 1 6 both applicationclients and administration clients can connect to the broker the jms specificationdoes not dictate that providers implement any specific wire protocols message queue services used by application clients and administration clients to connect to the broker are currently layered on top of tcp tls http or https protocols serviceslayered on top of http allow messages to pass through firewalls services that provide jms support and allow clients to connectto the broker jms ssljms http or https have a service type of normal andare layered on top of tcp tls http or https protocols services that allow administrators to connect to the broker admin ssladmin have a service typeof admin and are layered on top of tcp or tls protocols by default when you start the broker jms and admin services are up and running additionally you can configurea broker to run any or all of these connection services each service supportsspecific authentication and authorization access control features and eachservice is multi-threaded supporting multiple connections should a connection fail the message queue service can automaticallyretry connecting the client to the same broker or to a different broker ifthis feature is enabled for more information see the description of theautomatic reconnect feature in appendix b message queue features clients can configure connection runtime support when they create theconnection factory from which they obtain their connections options allowyou to specify which brokers to connect to how to handle reconnection messageflow control and so on for additional information about how connectionscan be configured see connection factories and connections at the heart of the message service is the broker which routes anddelivers messages reliably authenticates users and gathers data for monitoringperformance to route and deliver messages the broker places incomingmessages in their respective destinations and manages message flow into andout of these destinations to provide reliable delivery the broker uses a persistentstore to save state information and persistent messages until they are received.should the broker or the connection fail the saved information allows thebroker to restore the broker s state and to retry operations to provide security for the data being exchanged the brokeruses authenticated connections optionally data may be encrypted by runningover a secure protocol like ssl the broker also uses and manages a repositorythat holds information about users and the data or operations they can access.the broker authenticates users requesting services and authorizes the operationsthey want to carry out by looking up information in this repository to monitor the system the broker generates metrics and diagnosticinformation that an administrator can access to measure performance and totune the broker metrics information is also available programmatically toallow applications to adjust message flow and patterns to improve performance the message queue service provides a variety of administrative toolsthat the administrator can use to configure broker support for more information see administration client runtime support is provided in libraries that you link with whenbuilding message queue clients you can think of the client runtime as thebit of the message queue service that becomes part of the client for example when client code makes an api call to send a message code in these librariesis invoked that packages the message bits appropriately for the protocol thatwill be used to relay the message to the physical destination on the broker a jms provider is only required to support java clients however as figure 1 6 shows a message queue client canuse either the java or a provider-specific c api to send or receive a message.these interfaces are implemented in java or c runtime libraries which dothe actual work of creating connections to the broker and packaging the bitsappropriately for the connection service requested the java client runtime supplies java clients with the objectsneeded to interact with the broker these objects include connections sessions messages message producers and message consumers the c client runtime supplies c clients with the functionsand structures needed to interact with the broker it supports a proceduralversion of the jms programming model c clients can not use jndi to accessadministered objects but can create connection factories and destinationsprogrammatically the message queue service provides a c api to enable legacy c and c++applications to participate in jms-based messaging there are a number ofdifferences in the functionality provided by these two apis these are documentedin java and c clients it is important to remember that the jms specification is a standardfor java clients only c support is specific to the message queue providerand should not be used in client applications that you plan to port to otherproviders message queue java clients are also able to send and receive soap messages wrapped as jms messages soap simple object access protocol allows the exchangeof structured data between two peers in a distributed environment the dataexchanged is specified by an xml scheme sun soap processing is currently limited to using a point-to-point modeland does not guarantee reliability by wrapping a soap message in a jms messageand routing it using the broker you can take advantage of full featured message queue messagingwhich guarantees reliable delivery and allows you to use the topic as wellas the point-to-point domain message queue provides utility routines thata message producer can use to wrap a soap message into a jms message and thata message consumer can use to extract a soap message from the jms message working with soap messages gives youa more detailed view of soap message processing the message queue service offers command line tools that you can useto do the following start and configure the broker create and manage destinations manage broker connections and manage broker resources add list update and deleted administered objects in a jndiobject store populate and manage a file-based user repository create and manage a jdbc compliant database for persistentstorage you can also use a gui-based administration console to perform the followingcommand-line functions connect to a broker and manage it create and manage physical destinations connect to an object store add objects to the store andmanage them as the number of clients or the number of connections grows you mayneed to scale the message service to eliminate bottlenecks or to improve performance.the message queue message service offers a number of scaling options dependingon your needs these may be conveniently sorted into the following categories vertical scaling is achieved by addingmore processing power and by expanding available resources you can do thisby adding more processors or memory by switching to a shared thread model or by running the java vm in 64 bit mode if you are using thepoint-to-point domain you can scale the consumer side by allowing multipleconsumers to access a queue using this approach you can specify the maximumnumber of active and backup consumers the load-balancing mechanism also takesinto account a consumer s current capacity and message processing rate.this is a message queue feature the jms specification defines messagingbehavior if only one consumer is accessing a queue behavior for queues allowingmore than one consumer is provider-specific the message queue developer guidesprovide more information about this scaling option stateless horizontal scaling is achievedby using additional brokers and redistributing existing clients to these brokers.this approach is easy to implement but it is appropriate only if your messagingoperations can be divided into independent work groups stateful horizontal scaling is achievedby connecting brokers into a cluster in a broker cluster each broker is connected to every other broker in the cluster as well as toits local application clients brokers can be on the same host or distributedacross a network information about destinations and consumers is replicatedon all the brokers in the cluster updates to destinations or subscribersis also propagated each broker can therefore route messages from producersto which it is directly connected to consumers that are connected to otherbrokers in the cluster in situations where backup consumers are used ifone broker or connection fails messages sent to inaccessible consumers canbe forwarded to a backup consumers on another broker in the eventof broker or connection failure state information about persistent entities destinations and durable subscriptions can get out of sync for example if a clustered broker goes down and a destination is created on another brokerin the cluster when the first broker restarts it will not know about thenew destination to forestall this problem you can designate one broker inthe cluster to be the master broker this broker is responsiblefor tracking all changes to destinations and durable subscriptions in a master configuration file and for updating brokers in the clusterthat are temporarily offline for additional information see chapter 4 broker clusters evenwhen using a master broker message queue only provides service availability not data availability in the case of broker or connection failure for example if a clustered broker becomes unavailable any persistent messages held bythat broker become unavailable until that broker recovers currently theonly means to assure data availability is through the use of a suncluster message queue agent.in this case a persistent store is kept on a shared file system if a brokerfails the message queue agent on a second node starts a broker that takesover the shared store clients are reconnected to that broker thereby gettingboth continuous service and access to persistent data