usmt 5 and onedrive for business migration issue we are using sccm configuration manager 2012 r2 with usmt 5 for refreshing the windows 8 devices with our new 8.1 image the one drive for business odfb sync folder in the migrated user 's folder is being correctly stored and replaced but the sync status and settings of the odfb application are not after the refresh when the user launches odfb they are asked to start syncing as if they had not already been doing so before the refresh problem starting a sync results in a new sync folder being created and populated in their user folder that duplicates the sync folder that was migrated over taking up precious ssd space the win 8 being refreshed and the new win 8.1 image both have the same version of the odfb client that was installed as part of office 2013 pro plus with sp1 added to be sure i have even tried to refresh an already refreshed tablet to make sure the applications are exactly the same version options we have discussed 1 excluding the odfb folder by using a custom xml but we do n't have any experience with nbsp writing one or using it nbsp with sccm osd. nbsp it also seems like it would be nbsp challenging to write nbsp one as nbsp the folder is created as the user 's name em blah.or em g and so it is unique on every device and account being migrated 2 finding the registry entries or config file that need to be migrated but are not for sync status and folder location have n't had any luck tracking these down any help or insight is appreciated ok here 's my custom xml file you will obviously have to remove most of my custom includes and excludes migration urlid= http //www.microsoft.com/migration/1.0/migxmlext/test br migrates all files in custom program files folders lt component context= quot userandsystem quot type= quot application quot gt br displayname migrate data in program files directory /displayname nbsp lt role role= quot settings quot gt br rules nbsp nbsp nbsp nbsp nbsp lt include gt br objectset nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt communicator gt br pattern type= registry hkcu\software\microsoft\communicator\* /pattern span style= white-space pre span pattern type= file csidl_appdata \microsoft\communicator\* /pattern span style= white-space pre span gadgets nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt csidl_local_appdata \microsoft\windows sidebar\* lt pattern nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot registry quot gt hkcu\software\microsoft\windows\currentversion\sidebar\settings\* lt pattern span style= white-space pre span hewlett packard trim 7 span style= white-space pre span pattern type= file csidl_appdata \roaming\hewlett-packard\* /pattern span style= white-space pre span pattern type= file csidl_local_appdata \roaming\hewlett-packard\* /pattern span style= white-space pre span pattern type= registry hkcu\software\hewlett-packard\* /pattern nbsp nbsp nbsp nbsp nbsp nbsp lt objectset nbsp nbsp nbsp nbsp nbsp lt include nbsp nbsp lt rules nbsp lt role lt component br this component forces inclusion of user desktop shortcuts lt component type= quot documents quot context= quot user quot gt br displayname include user desktop shortcuts /displayname nbsp nbsp lt role role= quot data quot gt br rules nbsp nbsp nbsp lt include gt br objectset nbsp nbsp nbsp lt pattern type= quot file quot gt csidl_desktop \* *.lnk lt pattern nbsp nbsp nbsp lt pattern type= quot file quot gt csidl_desktop \* *.lnk2 lt pattern nbsp nbsp nbsp lt objectset nbsp nbsp nbsp lt include nbsp nbsp lt rules nbsp lt role lt component br this component exludes all folders/files in specific folders/drives lt component type= quot documents quot context= quot system quot gt br displayname exclude c drivers folder msocache folder autolog c root files d drive x drive /displayname nbsp nbsp nbsp nbsp lt role role= quot data quot gt br rules nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude gt br objectset nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \drivers\* lt pattern exludes c \drives folder span style= white-space pre span pattern type= file c \autolog\* /pattern exludes c \autolog folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \msocache\* lt pattern exludes c \msocache folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \programdata\* lt pattern exludes c \programdata folder span style= white-space pre span pattern type= file c \program files\* /pattern exludes c \program files folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \program files x86 \* lt pattern exludes c \program files x86 folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \users\default\* lt pattern exludes default profile folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \users\public\desktop\* lt pattern exludes public user desktop profile folder span style= white-space pre span pattern type= file x \* /pattern exludes x drive span style= white-space pre span pattern type= file e \* /pattern exludes e drive span style= white-space pre span pattern type= file d \* /pattern exludes d drive span style= white-space pre span pattern type= file c /pattern exludes c root files span style= white-space pre span pattern type= file c \intel\* /pattern exludes c \intel folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt objectset nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude nbsp nbsp nbsp nbsp nbsp nbsp lt rules nbsp nbsp nbsp nbsp lt role lt component lt migration you can modify this file by including your onedrive folder exclusion using something like the following pattern type= file profilefolder \onedrive /pattern exludes onedrive files i have n't ever needed to exclude a folder with usmt migration targeting all profiles however the usmt documentation indicates that this should work however it can be pretty picky so i would suggest testing manually with your usmt scanstate.exe you can include this custom.xml in your scanstate argument like this scanstate.exe /i migapp.xml /i miguser.xml /i custom.xml /o /localonly /lc \windows\scanstate.log /progress c \windows\usmtprogress.log /v:13 /c /ue administrator /config config.xml /targetwindows7 just modify it to suit what you have i.e if you do n't have a config.xml remove that part of the argument once you have this working its just a matter of updating your usmt package in sccm that your ts references with your custom.xml file re-dist the package then add that as a configuration file within the capture user state step config mgr should then just add that xml to the scanstate argument cheers damon p propos comme r ponse damon johns lundi 19 mai 2014 10:14 marqu comme r ponse joyce l moderator mardi 27 mai 2014 09:41 jeudi 15 mai 2014 22:47 r ponse citation text/html 04/06/2014 17:07:43 nd_csit 0 0 connectez-vous pour voter here is the custom.xml that we created and tested to be working migration urlid= http //www.microsoft.com/migration/1.0/migxmlext/test lt this component forces exclusion of skydrive onedrive sync folders nbsp lt component type= quot documents quot context= quot user quot gt br displayname exclude onedrive-skydrive folders from migrating to new computer /displayname nbsp nbsp nbsp nbsp lt role role= quot data quot gt br rules nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude gt br objectset nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt userprofile \onedrive*\* lt pattern nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt userprofile \skydrive*\* lt pattern nbsp nbsp nbsp nbsp nbsp lt objectset nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude nbsp nbsp nbsp nbsp lt rules nbsp nbsp lt role nbsp lt component nbsp lt migration i do n't know why microsoft left the goove settings out of the office 2013 migration settings in usmt 5.0 but this at least ensures the old sync folders are not included in the migration i might be able to help you with a custom.xml file to exclude the folders i 'm using one in my environment both manually and with sccm 2012 r2 osd i 'm at home presently but can provide the general syntax for you to leverage off tomorrow including the steps to change in your osd i 'm using usmt hard linking with my osd however i 'm sure you can adapt what i have in my ts to suit your own circumstances cheers damon ok here 's my custom xml file you will obviously have to remove most of my custom includes and excludes migration urlid= http //www.microsoft.com/migration/1.0/migxmlext/test br migrates all files in custom program files folders lt component context= quot userandsystem quot type= quot application quot gt br displayname migrate data in program files directory /displayname nbsp lt role role= quot settings quot gt br rules nbsp nbsp nbsp nbsp nbsp lt include gt br objectset nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt communicator gt br pattern type= registry hkcu\software\microsoft\communicator\* /pattern span style= white-space pre span pattern type= file csidl_appdata \microsoft\communicator\* /pattern span style= white-space pre span gadgets nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt csidl_local_appdata \microsoft\windows sidebar\* lt pattern nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot registry quot gt hkcu\software\microsoft\windows\currentversion\sidebar\settings\* lt pattern span style= white-space pre span hewlett packard trim 7 span style= white-space pre span pattern type= file csidl_appdata \roaming\hewlett-packard\* /pattern span style= white-space pre span pattern type= file csidl_local_appdata \roaming\hewlett-packard\* /pattern span style= white-space pre span pattern type= registry hkcu\software\hewlett-packard\* /pattern nbsp nbsp nbsp nbsp nbsp nbsp lt objectset nbsp nbsp nbsp nbsp nbsp lt include nbsp nbsp lt rules nbsp lt role lt component br this component forces inclusion of user desktop shortcuts lt component type= quot documents quot context= quot user quot gt br displayname include user desktop shortcuts /displayname nbsp nbsp lt role role= quot data quot gt br rules nbsp nbsp nbsp lt include gt br objectset nbsp nbsp nbsp lt pattern type= quot file quot gt csidl_desktop \* *.lnk lt pattern nbsp nbsp nbsp lt pattern type= quot file quot gt csidl_desktop \* *.lnk2 lt pattern nbsp nbsp nbsp lt objectset nbsp nbsp nbsp lt include nbsp nbsp lt rules nbsp lt role lt component br this component exludes all folders/files in specific folders/drives lt component type= quot documents quot context= quot system quot gt br displayname exclude c drivers folder msocache folder autolog c root files d drive x drive /displayname nbsp nbsp nbsp nbsp lt role role= quot data quot gt br rules nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude gt br objectset nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \drivers\* lt pattern exludes c \drives folder span style= white-space pre span pattern type= file c \autolog\* /pattern exludes c \autolog folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \msocache\* lt pattern exludes c \msocache folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \programdata\* lt pattern exludes c \programdata folder span style= white-space pre span pattern type= file c \program files\* /pattern exludes c \program files folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \program files x86 \* lt pattern exludes c \program files x86 folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \users\default\* lt pattern exludes default profile folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt c \users\public\desktop\* lt pattern exludes public user desktop profile folder span style= white-space pre span pattern type= file x \* /pattern exludes x drive span style= white-space pre span pattern type= file e \* /pattern exludes e drive span style= white-space pre span pattern type= file d \* /pattern exludes d drive span style= white-space pre span pattern type= file c /pattern exludes c root files span style= white-space pre span pattern type= file c \intel\* /pattern exludes c \intel folder nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt objectset nbsp nbsp nbsp nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude nbsp nbsp nbsp nbsp nbsp nbsp lt rules nbsp nbsp nbsp nbsp lt role lt component lt migration you can modify this file by including your onedrive folder exclusion using something like the following pattern type= file profilefolder \onedrive /pattern exludes onedrive files i have n't ever needed to exclude a folder with usmt migration targeting all profiles however the usmt documentation indicates that this should work however it can be pretty picky so i would suggest testing manually with your usmt scanstate.exe you can include this custom.xml in your scanstate argument like this scanstate.exe /i migapp.xml /i miguser.xml /i custom.xml /o /localonly /lc \windows\scanstate.log /progress c \windows\usmtprogress.log /v:13 /c /ue administrator /config config.xml /targetwindows7 just modify it to suit what you have i.e if you do n't have a config.xml remove that part of the argument once you have this working its just a matter of updating your usmt package in sccm that your ts references with your custom.xml file re-dist the package then add that as a configuration file within the capture user state step config mgr should then just add that xml to the scanstate argument cheers damon p propos comme r ponse damon johns lundi 19 mai 2014 10:14 marqu comme r ponse joyce l moderator mardi 27 mai 2014 09:41 jeudi 15 mai 2014 22:47 r ponse citation text/html 21/05/2014 15:04:14 nd_csit 0 0 connectez-vous pour voter damon that is very much appreciated can i make the custom.xml with only the exclude portion with the idea that usmt includes everything that it is already doing in the default setup or is it the case that if i go this route that i have to specify out manually in the custom.xml everything to include i guess what i do n't understand is if by specifying a custom.xml that this totally replaces the instructions for the user state capture or if it just appends these directions to the default includes/excludes please forgive my lack of understanding as this is brand new to me no the custom.xml file is used in addition to the rest of the xml files as a rule set so appends so you can do both includes and excludes or just one so in your case yes you can just have the custom exclude section of my file as i said though you have to get the xml exactly right otherwise the exclude wont work just enable logging with your testing on scanstate.exe and loadstate.exe and you should eventually get there /v with the highest verbosity level there is quite a bit of documentation on how to use usmt with the various switches just grab it out the the latest adk or look up the documentation on technet cheers damon thanks for the help with the custom.xml setup i was n't sure exactly how/where to add the custom component for the exclude to the xml schema that is created when you do generate a custom.xml with the information included in migapp miguser and migdoc xml files since i did n't use the super custom file generated my custom only has the component for excluding the folder i learned that i also then had to specify all four files in the task sequence on sccm when going this route at some point i plan on revisiting and testing adding the exclude to the all-inclusive custom.xml so that i just need to remember to add that one file to add to the task sequence here is the custom.xml that we created and tested to be working migration urlid= http //www.microsoft.com/migration/1.0/migxmlext/test lt this component forces exclusion of skydrive onedrive sync folders nbsp lt component type= quot documents quot context= quot user quot gt br displayname exclude onedrive-skydrive folders from migrating to new computer /displayname nbsp nbsp nbsp nbsp lt role role= quot data quot gt br rules nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude gt br objectset nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt userprofile \onedrive*\* lt pattern nbsp nbsp nbsp nbsp nbsp nbsp lt pattern type= quot file quot gt userprofile \skydrive*\* lt pattern nbsp nbsp nbsp nbsp nbsp lt objectset nbsp nbsp nbsp nbsp nbsp lt unconditionalexclude nbsp nbsp nbsp nbsp lt rules nbsp nbsp lt role nbsp lt component nbsp lt migration i do n't know why microsoft left the goove settings out of the office 2013 migration settings in usmt 5.0 but this at least ensures the old sync folders are not included in the migration hello all we just started using usmt and we have one drive in our environment how can i exclude all onedrive sync folders p edge